---
- hosts: localhost
  become: no

  roles:
    # Just load default variables from roles.
    - role: kubespray-defaults
      when: false
    - role: download
      when: false

  tasks:
    - name: version_specified?
      set_fact:
        default_kube_version: "{{ kube_version }}"
        specified_version: "{{lookup('ansible.builtin.file', './contrib/offline/.use-kube-version') }}"
      failed_when: false
    - name: up_version
      set_fact:
        kube_version: "{{ specified_version }}"
      when: specified_version | length > 2
    - name: kube_version_info
      ansible.builtin.debug:
        msg:
          - "default kube version: {{ default_kube_version }}"
          - "current kube version: {{ kube_version }}"
          - "The minimum version working: {{ kube_version_min_required }}"
    # Generate files.list and images.list files from templates.
    - template:
        src: ./contrib/offline/temp/{{ item }}.list.template
        dest: ./contrib/offline/temp/{{ item }}.list
      with_items:
        - files
        - images
