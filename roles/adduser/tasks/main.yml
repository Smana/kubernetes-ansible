---
- name: check if atomic host
  stat:
    path: /run/ostree-booted
  register: ostree

- set_fact:
    is_atomic: "{{ ostree.stat.exists }}"

- name: User | Create User Group
  group:
    name: "{{user.group|default(user.name)}}"
    system: "{{user.system|default(omit)}}"

- name: User | Create User
  user:
    comment: "{{user.comment|default(omit)}}"
    createhome: "{{user.createhome|default(omit)}}"
    group: "{{user.group|default(user.name)}}"
    home: "{{user.home|default(omit)}}"
    shell: "{{user.shell|default(omit)}}"
    name: "{{user.name}}"
    system: "{{user.system|default(omit)}}"
  when:
    - not is_atomic
