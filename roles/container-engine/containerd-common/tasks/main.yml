---
- name: containerd-common | check if fedora coreos
  stat:
    path: /run/ostree-booted
    get_attributes: no
    get_checksum: no
    get_mime: no
  register: ostree

- name: containerd-common | set is_ostree
  set_fact:
    is_ostree: "{{ ostree.stat.exists }}"

- name: containerd-common | gather os specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - files:
        - "{{ ansible_facts.distribution|lower }}-{{ ansible_facts.distribution_version|lower|replace('/', '_') }}.yml"
        - "{{ ansible_facts.distribution|lower }}-{{ ansible_facts.distribution_release|lower }}-{{ host_architecture }}.yml"
        - "{{ ansible_facts.distribution|lower }}-{{ ansible_facts.distribution_release|lower }}.yml"
        - "{{ ansible_facts.distribution|lower }}-{{ ansible_facts.distribution_major_version|lower|replace('/', '_') }}.yml"
        - "{{ ansible_facts.distribution|lower }}-{{ host_architecture }}.yml"
        - "{{ ansible_facts.distribution|lower }}.yml"
        - "{{ ansible_facts.os_family|lower }}-{{ host_architecture }}.yml"
        - "{{ ansible_facts.os_family|lower }}.yml"
        - defaults.yml
      paths:
        - ../vars
      skip: true
  tags:
    - facts
