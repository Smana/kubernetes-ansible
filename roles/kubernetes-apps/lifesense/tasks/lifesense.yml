- name: lifesense | Assures {{ kube_addons_dir }}/lifesense dir exists
  file: path={{ kube_addons_dir }}/lifesense state=directory
  tags: k8s-config

- name: lifesense | Assures {{ kube_addons_dir }}/lifesense/{{lifesense_env}} dir exists
  file: path={{ kube_addons_dir }}/lifesense/{{lifesense_env}} state=directory
  tags: k8s-config

- name: 
  template: src="lifesense/lifesense-limits.yaml" dest="{{ kube_addons_dir }}/lifesense/lifesense-limits.yaml"
  tags: k8s-config

- name: 
  template: src="lifesense/lifesense-cm.yaml" dest="{{ kube_addons_dir }}/lifesense/{{lifesense_env}}/lifesense-cm.yaml"
  tags: k8s-config

- name: 
  template: src="lifesense/lifesense-ns.yaml" dest="{{ kube_addons_dir }}/lifesense/{{lifesense_env}}/lifesense-ns.yaml"
  tags: k8s-config

- name: lifesense | Assures {{ kube_addons_dir }}/lifesense/ingress dir exists
  file: path={{ kube_addons_dir }}/lifesense/ingress state=directory
  tags: k8s-config

- name:
  template: src="lifesense/lifesense-ingress.yaml.j2" dest="{{ kube_addons_dir }}/lifesense/ingress/{{item}}-ingress.yaml"
  with_items:
  - "sports-{{lifesense_env|regex_replace('lifesense-','')}}.lifesense.com"  
  tags: k8s-config

- name:
  template: src="lifesense/lifesense-websocket-ingress.yaml" dest="{{ kube_addons_dir }}/lifesense/ingress/{{item}}-ingress.yaml"
  with_items:
  - "websocket-{{lifesense_env|regex_replace('lifesense-','')}}.lifesense.com"  
  tags: k8s-config

- name:
  template: src="lifesense/lifesense-static-ingress.yaml" dest="{{ kube_addons_dir }}/lifesense/ingress/{{item}}-ingress.yaml"
  with_items:
  - "static-{{lifesense_env|regex_replace('lifesense-','')}}.lifesense.com"  
  tags: k8s-config

- name: lifesense | Assures {{ kube_addons_dir }}/lifesense/svc dir exists
  file: path={{ kube_addons_dir }}/lifesense/svc state=directory
  tags: k8s-config

- name:
  template: src="lifesense/lifesense-svc.yaml.j2" dest="{{ kube_addons_dir }}/lifesense/svc/{{item.name}}-svc.yaml"
  when: item.rest
  with_items: "{{soa}}"
  tags: k8s-config

- name:
  template: src="lifesense/lifesense-soa-svc.yaml.j2" dest="{{ kube_addons_dir }}/lifesense/svc/{{item}}-svc.yaml"
  with_items: 
  - websocket
  - socket
  tags: k8s-config

- name: lifesense | Assures {{ kube_addons_dir }}/lifesense/soa dir exists
  file: path={{ kube_addons_dir }}/lifesense/soa state=directory
  tags: k8s-config

- name:
  template: src="lifesense/lifesense-controller.yaml.j2" dest="{{ kube_addons_dir }}/lifesense/soa/{{item.name}}-controller.yaml"
  with_items: "{{soa}}"
  tags: k8s-config