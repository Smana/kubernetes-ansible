---
- name: "ElasticSearch | Write efk manifests (RBAC)"
  template:
    src: "{{ item }}"
    dest: "{{ kube_config_dir }}/{{ item }}"
  with_items:
    - "efk-sa.yml"
    - "efk-clusterrolebinding.yml"
  run_once: true
  register: rbac_config
  when: rbac_enabled

- name: "ElasticSearch | Create Serviceaccount and Clusterrolebinding (RBAC)"
  command: "{{ bin_dir }}/kubectl apply -f {{ kube_config_dir }}/{{ item }} -n {{ system_namespace }}"
  with_items:
    - "efk-sa.yml"
    - "efk-clusterrolebinding.yml"
  run_once: true
  when: rbac_config.changed

