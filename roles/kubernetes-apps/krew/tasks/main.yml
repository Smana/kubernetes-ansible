---
- name: Krew | Download krew
  include_tasks: "../../../download/tasks/download_file.yml"
  vars:
    download: "{{ download_defaults | combine(downloads.krew) }}"

- name: Krew | krew env
  template:
    src: krew.j2
    dest: /etc/bash_completion.d/krew

- name: Krew | Install krew
  shell: "{{ local_release_dir }}/krew-linux_{{ image_arch }} install krew {% if krew_no_update_index %}--no-update-index{% endif %}"
  environment:
    KREW_ROOT: "{{ krew_root_dir }}"
    KREW_DEFAULT_INDEX_URI: "{{ krew_default_index_uri }}"
