---
- name: Kubernetes Apps | Delete old CoreDNS resources
  k8s:
    name: "coredns"
    namespace: "kube-system"
    kind: "{{ item }}"
    state: absent
  with_items:
    - 'Deployment'
    - 'ConfigMap'
    - 'Service'
  tags:
    - upgrade

- name: Kubernetes Apps | Delete kubeadm CoreDNS
  k8s:
    name: "coredns"
    namespace: "kube-system"
    kind: "Deployment"
    state: absent
  when:
    - kubeadm_enabled|default(false)
    - kubeadm_init is defined
    - kubeadm_init.changed|default(false)
    - inventory_hostname == groups['kube-master'][0]

- name: Kubernetes Apps | Delete old KubeDNS resources
  k8s:
    name: "kube-dns"
    namespace: "kube-system"
    kind: "{{ item }}"
    state: absent
  with_items:
    - 'Deployment'
    - 'Service'
  tags:
    - upgrade

- name: Kubernetes Apps | Delete kubeadm KubeDNS
  k8s:
    name: "kube-dns"
    namespace: "kube-system"
    kind: "{{ item }}"
    state: absent
  with_items:
    - 'Deployment'
    - 'Service'
  when:
    - kubeadm_enabled|default(false)
    - kubeadm_init is defined
    - kubeadm_init.changed|default(false)
    - inventory_hostname == groups['kube-master'][0]
