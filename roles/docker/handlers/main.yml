---
- name: restart docker
  command: /bin/true
  notify:
    - Docker | reload systemd
    - Docker | reload docker
    - Docker | wait for docker

# NOTE(bogdando) reloading systemd daemon disturbs docker, we shall wait for it
- name : Docker | reload systemd
  command: /bin/true
  notify:
    - Docker | systemd-daemon-reload
    - Docker | wait for docker
  when: ansible_service_mgr == "systemd"

- name : Docker | systemd-daemon-reload
  shell: systemctl daemon-reload
  when: ansible_service_mgr == "systemd"

- name: Docker | reload docker
  service:
    name: docker
    state: restarted

- name: Docker | wait for docker
  command: /usr/bin/docker images
  register: docker_ready
  retries: 10
  delay: 5
  until: docker_ready.rc == 0
