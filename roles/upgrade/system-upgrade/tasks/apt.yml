---
- name: APT Dist-Upgrade
  apt:
    upgrade: dist
    autoremove: true
    dpkg_options: force-confold,force-confdef
  register: apt_upgrade

- name: Reboot after APT Dist-Upgrade  # noqa no-handler
  when:
  - apt_upgrade.changed or system_upgrade_reboot == 'always'
  - system_upgrade_reboot != 'never'
  reboot:
    msg: "INFO: Reboot issued by Kubespray roles/upgrade/system-upgrade"
    post_reboot_delay: {{ system_upgrade_post_reboot_delay | default(omit) }}
    pre_reboot_delay: {{ system_upgrade_pre_reboot_delay | default(omit) }}
    reboot_timeout: {{ system_upgrade_reboot_timeout | default(omit) }}
    test_command: {{ system_upgrade_test_command | default(omit) }}
