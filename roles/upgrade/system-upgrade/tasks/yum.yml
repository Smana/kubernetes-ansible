---
- name: YUM upgrade all packages  # noqa package-latest
  yum:
    name: '*'
    state: latest
  register: yum_upgrade

- name: Reboot after YUM upgrade  # noqa no-handler
  when:
  - yum_upgrade.changed or system_upgrade_reboot == 'always'
  - system_upgrade_reboot != 'never'
  reboot:
    msg: "INFO: Reboot issued by Kubespray roles/upgrade/system-upgrade"
    post_reboot_delay: {{ system_upgrade_post_reboot_delay | default(omit) }}
    pre_reboot_delay: {{ system_upgrade_pre_reboot_delay | default(omit) }}
    reboot_timeout: {{ system_upgrade_reboot_timeout | default(omit) }}
    test_command: {{ system_upgrade_test_command | default(omit) }}
