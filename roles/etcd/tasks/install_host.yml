---
- name: Install | Copy etcd and etcdctl binaries from docker container
  command: sh -c "{{ docker_bin_dir }}/docker rm -f etcd-binarycopy;
           {{ docker_bin_dir }}/docker create --name etcd-binarycopy {{ etcd_image_repo }}:{{ etcd_image_tag }} &&
           {{ docker_bin_dir }}/docker cp etcd-binarycopy:/usr/local/bin/etcd {{ bin_dir }}/etcd &&
           {{ docker_bin_dir }}/docker cp etcd-binarycopy:/usr/local/bin/etcdctl {{ bin_dir }}/etcdctl &&
           {{ docker_bin_dir }}/docker rm -f etcd-binarycopy"
  when: etcd_deployment_type == "host"
  register: etcd_task_result
  until: etcd_task_result.rc == 0
  retries: 4
  delay: "{{ retry_stagger | random + 3 }}"
  changed_when: false
