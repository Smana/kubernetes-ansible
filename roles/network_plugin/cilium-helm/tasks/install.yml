---
- name: Cilium Helm | Deploy helm chart
  when:
    - inventory_hostname == groups['kube_control_plane'][0]
  include_role:
    name: helm-apps
    apply:
      environment:
        http_proxy: "{{ http_proxy | default('') }}"
        https_proxy: "{{ https_proxy | default('') }}"
  vars:
    release_common_opts: {}
    releases:
      - name: cilium
        namespace: "{{ cilium_helm_namespace }}"
        chart_ref: "{{ cilium_helm_chart_ref }}"
        chart_version: "{{ cilium_helm_chart_version }}"
        wait: true
        values: "{{ cilium_helm_default_values | combine(cilium_helm_values) }}"
    repositories:
      - name: "{{ cilium_helm_repository_name }}"
        url: "{{ cilium_helm_repository_url }}"
