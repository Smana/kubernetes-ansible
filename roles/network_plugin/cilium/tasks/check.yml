---
- name: Cilium | Check cilium_ipsec_enabled variables
  assert:
    that:
      - "cilium_ipsec_key is defined"
    msg: "cilium_ipsec_key should be defined to use cilium_ipsec_enabled"
  when:
    - cilium_ipsec_enabled
    - cilium_tunnel_mode in ['vxlan']

- name: Stop if bad Cilium identity allocation mode
  assert:
    that: cilium_identity_allocation_mode in ['crd', 'kvstore']
    msg: "cilium_identity_allocation_mode must be either 'crd' or 'kvstore'"

- name: Stop if bad Cilium Cluster ID
  assert:
    that:
      - cilium_cluster_id <= 255
      - cilium_cluster_id >= 0
    msg: "'cilium_cluster_id' must be between 1 and 255"
  when: cilium_cluster_id is defined
