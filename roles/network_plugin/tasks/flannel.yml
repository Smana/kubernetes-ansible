---
- name: Flannel | Write flannel configuration
  template:
    src: flannel/network.json
    dest: /etc/flannel-network.json
    backup: yes
  when: inventory_hostname in groups['kube-node']

- name: Flannel | Create flannel pod manifest
  template:
    src: flannel/flannel-pod.yml
    dest: /etc/kubernetes/manifests/flannel-pod.manifest
  notify: restart flannel

- name: Flannel | Check for flannel port
  wait_for:
    port: 10253
    delay: 5
    timeout: 100

- name: Flannel | Write docker.service systemd file
  template:
    src: flannel/systemd-docker.service
    dest: /lib/systemd/system/docker.service
  notify: restart docker
  when: init_system == "systemd"
