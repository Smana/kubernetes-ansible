---
- name: file_download | upload file images to nodes
  synchronize:
    src: "{{ cache_path }}"
    dest: "{{ download.dest }}"
    use_ssh_args: "{{ has_bastion | default(false) }}"
    mode: push
  become: true
  register: get_task
  until: get_task is succeeded
  retries: 4
  delay: "{{ retry_stagger | random + 3 }}"
  when:
    - download.enabled
    - download.file
    - download_run_once
    - download_delegate != inventory_hostname or download_delegate == "localhost"
    - ansible_os_family not in ["CoreOS", "Container Linux by CoreOS"]
  tags:
    - upload
    - upgrade
