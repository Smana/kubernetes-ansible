- name: Dnsmasq | restart network
  async: 0
  poll: 0
  vars:
    ansible_ssh_pipelining: no
  shell: >-
      {% if ansible_os_family == "RedHat" -%}
      {%-  if ansible_service_mgr == "systemd" -%}
      systemctl restart network
      {%-  else -%}
      service network restart
      {%-  endif -%}
      {%- elif ansible_os_family == "Debian" -%}
      {%-  if ansible_service_mgr == "systemd" -%}
      systemctl restart networking && /sbin/dhclient -v $(awk '/^iface.*dhcp$/ {print $2}' /etc/network/interfaces)
      {%-  else -%}
      service networking restart && /sbin/dhclient -v $(awk '/^iface.*dhcp$/ {print $2}' /etc/network/interfaces)
      {%-  endif -%}
      {%- endif %}
  when: ansible_os_family != "CoreOS"
