---
#The reconciler sync wait time between volume attach detach.
#This duration must be larger than one second, and increasing this value
# from the default may allow for volumes to be mismatched with pods.
# If not configured, default value is 1min
- name: Configure Controller Manager Volume Attach Detach Reconcile sync period
  lineinfile:
    path: "/etc/kubernetes/manifests/kube-controller-manager.yaml"
    line: '    - --attach-detach-reconcile-sync-period={{ controller_manager_attach_detach_reconcile_sync_period }}s'
    insertafter: '- --allocate-node-cidrs=true'
    # Replace the line if present
    state: present
    regexp: '^    - --attach-detach-reconcile'
    backup: yes
  notify:
    - "Master | Restart kube-controller-manager"
