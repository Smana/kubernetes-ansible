---
apiVersion: apiserver.config.k8s.io/v1beta1
kind: AuthenticationConfiguration
jwt:
  - issuer:
      audiences: {{ ([kube_oidc_client_id] + kube_oidc_audiences) | to_json }}
      audienceMatchPolicy: MatchAny
{% if kube_oidc_ca_file is defined %}
      certificateAuthority: "{{ kube_oidc_ca_file }}"
{% endif %}
      url: "{{ kube_oidc_url }}"
    claimMappings:
{% if kube_oidc_username_claim is defined %}
      username:
        claim: "{{ kube_oidc_username_claim }}"
        prefix: "{{ kube_oidc_username_prefix }}"
{% endif %}
{% if kube_oidc_groups_claim is defined %}
      groups:
        claim: "{{ kube_oidc_groups_claim }}"
        prefix: "{{ kube_oidc_groups_prefix }}"
{% endif %}
{% if kube_oidc_uid_claim is defined %}
      uid:
        claim: "{{ kube_oidc_uid_claim }}"
{% endif %}
    userValidationRules:
{% for rule in kube_oidc_user_validation_rules + kube_oidc_additional_user_validation_rules %}
      - expression: "{{ rule.expression }}"
        message: "{{ rule.message }}"
{% endfor %}
