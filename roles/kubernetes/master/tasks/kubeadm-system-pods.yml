---
- set_fact:
    kubeadm_certs_dir: "{{ kube_config_dir }}/pki"

- name: Write kube-apiserver manifest
  template:
    src: manifests/kubeadm-kube-apiserver.json.j2
    dest: "{{ kube_manifest_dir }}/kube-apiserver.manifest"
  notify: Master | wait for the apiserver to be running

- name: Write kube-controller-manager manifest
  template:
    src: manifests/kubeadm-kube-controller-manager.json.j2
    dest: "{{ kube_manifest_dir }}/kube-controller-manager.manifest"
  notify: Master | wait for kube-controller-manager

- name: Write kube-scheduler manifest
  template:
    src: manifests/kubeadm-kube-scheduler.json.j2
    dest: "{{ kube_manifest_dir }}/kube-scheduler.manifest"
  notify: Master | wait for kube-scheduler
