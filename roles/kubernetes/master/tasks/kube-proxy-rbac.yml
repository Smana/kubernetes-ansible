---
- name: Lay down kube-proxy-rbac manifest
  copy:
    src: "kube-proxy-rbac.yaml"
    dest: "{{ kube_config_dir }}/kube-proxy-rbac.yaml"
  run_once: yes
  register: kube_proxy_rbac_manifest

- name: Apply kube-proxy-rbac manifest
  kube:
    name: kube-proxy
    namespace: "kube-system"
    kubectl: "{{ bin_dir }}/kubectl"
    resource: "role"
    filename: "{{ kube_config_dir }}/kube-proxy-rbac.yaml"
    state: present
  run_once: yes
  environment:
    KUBECONFIG: "{{ kube_config_dir }}/admin.conf"
