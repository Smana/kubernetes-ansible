
- block:
  - name: Turn on SERVING certificates rotation for kubelet
    lineinfile:
      path: "{{ postinstall_kubelet_config_path }}"
      state: present
      line: "rotateServerCertificates: true"
    notify: restart kubelet

  - name: Turn on signing requests by kube-config-manager
    lineinfile:
      path: "{{ postinstall_control_manager_config_path }}"
      insertafter: "- kube-controller-manager"
      line: "    - --experimental-cluster-signing-duration={{ postinstall_signing_duration }}"
      regexp: --experimental-cluster-signing-duration=

  when: inventory_hostname in groups['kube-master']

- name: Turn on CLIENT certificates rotation for kubelet
  lineinfile:
    path: "{{ postinstall_kubelet_config_path }}"
    state: present
    line: "rotateCertificates: true"
  notify: restart kubelet
